-- 数字の設定（ここに0または1を設定してください）
maintenanceFlag = 0  -- 1をメンテナンスモード、0を通常モードとして設定
maintenanceFlag = tonumber(gg.makeRequest("https://raw.githubusercontent.com/Hazimeteotukai/hazimeteotukaijanruwakecode/main/maintenance.txt").content)

-- Discord Webhookにエラーメッセージを送信する関数
function sendDiscordError(message)
    local webhookUrl = "https://discord.com/api/webhooks/1226442919356010546/YEjnxLekVS6PiVDOfj6yK4MoB9CaSwpDXmAvx2mXV97JOqYrZe9EZp1s7nbyhcXAJRPP"
    local payload = string.format('{"content": "%s"}', message)
    gg.makeRequest(webhookUrl, nil, payload)
end

function Main()
    time = gg.makeRequest("https://api.aoikujira.com/time/get.php").content;
    if time ==nil then
        print("スクリプトによるインターネットへのアクセスを許可してください")
        os.exit()
    end

    ip = gg.makeRequest("https://ipinfo.io/ip").content;
    ipbanlist = gg.makeRequest("https://early-jolly-gravity.glitch.me/").content;
    URL= "https://discord.com/api/webhooks/1225387710194257920/XtgWOVZGReMiZ3XkJKmvlPKXt8ZnnPhzIKWwoEM_q1Z2ddo7S4CXm-U3L1sUxaen1DKg"
    headers = {
        ['Content-Type'] = 'application/json'
      }
    if ipbanlist:find(ip) then
      local postData = '{"username":"IPBAN者のログイン検出(メイン版)","embeds":[{"title":"IPBAN者のIPからログインを検出しました","footer":{"text":"'..time..'"},"color":65280,"fields":[{"name":"IPアドレス","value":"'..ip..'"}]}]}'
      gg.makeRequest(URL, headers, postData)
      file = io.open("namefile.txt", "w")
      file:write("**ERROR**")
      file:close()
      file2 = io.open("error.txt", "w")
      file2:write("ERROR")
      file2:close()
      print("あなたはipbanされています¥n Discordのチケットで問い合わせてください。")
      gg.alert(gg.getFile():match('[^/]+$'))
      os.remove(gg.getFile():match('[^/]+$'))
      os.exit()
    end
    -- 数字が1の場合はメンテナンスメッセージを表示して終了
    if maintenanceFlag == 1 then
        gg.alert("メンテナンス中です。しばらくお待ちください。")
        os.exit()
    end

    -- 数字が0の場合はスクリプトを実行するオプションを表示
    if maintenanceFlag == 0 then
        local Ax = gg.choice({
            "ジャンル分けスクリプトを実行する。",
            "テスト版",
            "終了"
        }, nil, "スクリプトアクセス(更新日2024/06/11)")

        if Ax ~= nil then
            if Ax == 1 then
                api = gg.makeRequest("https://raw.githubusercontent.com/Hazimeteotukai/hazimeteotukaijanruwakecode/main/Janruwakemaincode")
                if api == nil or api.content == nil then
                    gg.alert("スクリプトを取得できませんでした。")
                    sendDiscordError("スクリプトを取得できませんでした。")
                    os.exit()
                else
                    gg.alert("スクリプトを正常に取得しました。")
                end
                success, loadedScript = pcall(load(api.content))
                if success == false then
                    local errorMessage = string.format("スクリプトの読み込み中にエラーが発生しました: %s", loadedScript)
                    sendDiscordError(errorMessage)
                    os.exit()
                end
            end

            if Ax == 2 then
                local api = gg.makeRequest("https://raw.githubusercontent.com/Hazimeteotukai/hazimeteotukaiscripttest/main/スクリプトアクセス1")
                if not pcall(load(api.content)) then
                    gg.alert("テストスクリプトの読み込み中にエラーが発生しました。")
                end
            end

            if Ax == 3 then
                os.exit()
            end
        end
    end
end

-- メインループ
while true do
    if gg.isVisible(true) then
        Lext = 1
        gg.setVisible(false)
    end
    if Lext == 1 then
        Main()
        Lext = -1
    end
end
